<Window x:Class="Client.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
        Title="Cruise Management System" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#F6F8FA">

    <DockPanel>
        <!-- Toolbar za akcije -->
        <ToolBar DockPanel.Dock="Top" Background="#E3EAF2">
            <Button Content="Add Voyage" Command="{Binding AddVoyageCommand}" Margin="2" />
            <Button Content="Edit Voyage" Command="{Binding EditVoyageCommand}" Margin="2" />
            <Button Content="Delete Voyage" Command="{Binding DeleteVoyageCommand}" Margin="2" />
            <Separator />
            <Button Content="Add Ship" Command="{Binding AddShipCommand}" Margin="2" />
            <Button Content="Add Port" Command="{Binding AddPortCommand}" Margin="2" />
            <Separator />
            <Button Content="Undo" Command="{Binding UndoCommand}" Margin="2" />
            <Button Content="Redo" Command="{Binding RedoCommand}" Margin="2" />
            <Separator />
            <Button Content="{Binding ShowCruisesButtonText}" Command="{Binding ShowCruisesCommand}" Margin="2" />
        </ToolBar>

        <!-- Status bar -->
        <StatusBar DockPanel.Dock="Top" Background="#E8F4FD">
            <StatusBarItem>
                <TextBlock Text="{Binding CurrentViewMessage}" FontWeight="Bold" Foreground="DarkBlue" />
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock Text="|" />
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock Text="{Binding ChartsVM.TotalVoyages, StringFormat='Total Voyages: {0}'}" Foreground="DarkGreen" />
            </StatusBarItem>
        </StatusBar>

        <!-- Search box -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="10,8,10,8" Background="#F0F4F8">
            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,5,0" FontWeight="Bold" />
            <TextBox Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}" Width="220" Margin="0,0,5,0" />
            <Button Content="Search" Command="{Binding SearchCommand}" Margin="5,0,0,0" />
        </StackPanel>

        <!-- Glavni sadržaj -->
        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="2*" />
                <RowDefinition Height="3*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Statistics Info -->
            <Border Grid.Row="0" Padding="10" Background="#E8F4FD" Margin="0,0,0,10"
                    BorderBrush="#BBDEFB" BorderThickness="1" CornerRadius="5">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Total Voyages: " FontWeight="Bold" Margin="0,0,5,0" />
                    <TextBlock Text="{Binding ChartsVM.TotalVoyages}" Foreground="Blue" Margin="0,0,15,0" />
                    <TextBlock Text="State Distribution: " FontWeight="Bold" Margin="0,0,5,0" />
                    <TextBlock Text="{Binding ChartsVM.CurrentStateDistribution}" Foreground="DarkGreen" />
                </StackPanel>
            </Border>

            <!-- Grafikoni za Voyage stanja -->
            <Grid Grid.Row="1" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Bar Chart -->
                <Border Grid.Column="0" Margin="0,0,5,0" Background="White"
                        BorderBrush="#D0D7DE" BorderThickness="1" CornerRadius="6">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Voyage States Distribution"
                                   FontWeight="Bold" FontSize="14" Margin="10"
                                   HorizontalAlignment="Center" />

                        <lvc:CartesianChart Grid.Row="1"
                                            Series="{Binding ChartsVM.VoyageStateSeries}"
                                            XAxes="{Binding ChartsVM.XAxes}"
                                            YAxes="{Binding ChartsVM.YAxes}"
                                            Margin="10"
                                            TooltipPosition="Top">
                        </lvc:CartesianChart>
                    </Grid>
                </Border>

                <!-- Pie Chart -->
                <Border Grid.Column="1" Margin="5,0,0,0" Background="White"
                        BorderBrush="#D0D7DE" BorderThickness="1" CornerRadius="6">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Voyage States Percentage"
                                   FontWeight="Bold" FontSize="14" Margin="10"
                                   HorizontalAlignment="Center" />

                        <lvc:PieChart Grid.Row="1"
                                      Series="{Binding ChartsVM.VoyageStatePieSeries}"
                                      Margin="10"
                                      InitialRotation="0">
                        </lvc:PieChart>
                    </Grid>
                </Border>
            </Grid>

            <!-- DataGrid za prikaz Voyages -->
            <DataGrid Grid.Row="2"
                      ItemsSource="{Binding Voyages}"
                      SelectedItem="{Binding SelectedVoyage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      AutoGenerateColumns="False"
                      Margin="0,0,0,10"
                      IsReadOnly="True"
                      RowHeaderWidth="0"
                      SelectionMode="Single"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserResizeRows="False"
                      HeadersVisibility="Column"
                      AlternatingRowBackground="#F5F7FA"
                      GridLinesVisibility="Horizontal"
                      BorderBrush="#D0D7DE"
                      BorderThickness="1">

                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Background" Value="White" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsCruise}" Value="True">
                                <Setter Property="Background" Value="#F0F8FF" />
                                <Setter Property="FontWeight" Value="SemiBold" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>

                <DataGrid.Columns>
                    <!-- Type indicator -->
                    <DataGridTextColumn Header="Type" Width="80">
                        <DataGridTextColumn.Binding>
                            <MultiBinding StringFormat="{}{0}">
                                <Binding Path="IsCruise" />
                            </MultiBinding>
                        </DataGridTextColumn.Binding>
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="⛴️ VOYAGE" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsCruise}" Value="True">
                                        <Setter Property="Text" Value="🚢 CRUISE" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Code" Binding="{Binding Code}" Width="100" />
                    <DataGridTextColumn Header="Departure" Binding="{Binding DepartureTime, StringFormat=dd/MM/yyyy HH:mm}" Width="120" />
                    <DataGridTextColumn Header="Arrival" Binding="{Binding ArrivalTime, StringFormat=dd/MM/yyyy HH:mm}" Width="120" />
                    <DataGridTextColumn Header="Ship" Binding="{Binding ShipName}" Width="120" />
                    <DataGridTextColumn Header="From" Binding="{Binding DeparturePortName}" Width="120" />
                    <DataGridTextColumn Header="To" Binding="{Binding ArrivalPortName}" Width="120" />
                    <DataGridTextColumn Header="Distance" Binding="{Binding Distance, StringFormat={}{0} km}" Width="80" />
                    <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100" />
                    <DataGridTextColumn Header="Captain Message" Binding="{Binding CaptainMessage}" Width="200" />

                    <!-- Cruise-specific columns -->
                    <DataGridTextColumn Header="Cruise Name" Binding="{Binding CruiseName}" Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsCruise}" Value="True">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTemplateColumn Header="Actions" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <!-- Simulate dugme - samo za voyage -->
                                    <Button Content="Simulate"
                                            Command="{Binding DataContext.SimulateStateChangeCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Padding="4,2"
                                            Margin="2"
                                            Background="#D6EAF8"
                                            BorderBrush="#2980B9"
                                            BorderThickness="1">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsCruise}" Value="True">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- Info za cruise -->
                                    <TextBlock Text="🚢 Cruise" FontStyle="Italic" Foreground="Gray" VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsCruise}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </DockPanel>
</Window>